package application.telas;
import java.net.URL;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;
import java.util.ResourceBundle;

import com.mysql.jdbc.PreparedStatement;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;

//THIS IS MY CODE MOTHERFUCKER!
public class Conexao {
	private Connection conexao = null;
	private Statement statement = null;
	private Object resultset = null;
	private String driver = "com.mysql.jdbc.Driver";
	private String url = "jdbc:mysql://localhost:3306/sophiadb";
	private String user = "root";
	private String pass = "";
	public List<Pessoa> alunos = new ArrayList<Pessoa>();
	public List<Informacoes> infs = new ArrayList<Informacoes>();
	public Pessoa person = new Pessoa();
	public Informacoes infor = new Informacoes();
	public Integer tamanho = 0;
	public String getUrl(){
		return url;
	}
	
	public void Conectar(){
		try {
			Class.forName(driver);
			this.conexao = DriverManager.getConnection(url, user, pass);
			this.statement = this.conexao.createStatement();
		} catch (Exception e){
			System.out.println("Erro ao conectar no DATABASE: "+e.getMessage());
		}
	}
	
	public boolean verificaConexao(){
		if(this.conexao != null){
			return true;
		}
		else {
			return false;
		}
	}
	
	public void ReceberAlunos(){
		ResultSet rs = null;
		try {
			PreparedStatement cmd = (PreparedStatement)this.conexao.prepareStatement("SELECT * FROM alunos");
			rs = cmd.executeQuery();
			while (rs.next()){
				Pessoa alewno = new Pessoa();
				alewno.setNome(rs.getString("nome"));
				alewno.setNchamada(rs.getInt("nchamada"));
				alewno.setIdade(rs.getInt("idade"));
				alewno.setEmail(rs.getString("email"));
				alunos.add(alewno);
			}
			PreparedStatement cmd2 = (PreparedStatement)this.conexao.prepareStatement("SELECT * FROM informacoes");
			rs = cmd2.executeQuery();
			while(rs.next()){
				Informacoes inf = new Informacoes();
				inf.setSexo(rs.getBoolean("sexo"));
				inf.setBarba(rs.getBoolean("barba"));
				inf.setCareca(rs.getBoolean("careca"));
				inf.setId_carac(rs.getInt("id_carac"));
				infs.add(inf);
			}
			cmd.close();
		} catch (SQLException e) {
			System.out.println("Erro ao Conectar ao DB!"+e.getMessage());
		}
	}
	
	public void listarTabela(){
		try{
			String comando = "SELECT * FROM alunos ORDER BY nchamada";
			this.resultset = this.statement.executeQuery(comando);
			this.statement = this.conexao.createStatement();
			while(((ResultSet) this.resultset).next()){
				System.out.println("ID: "+((ResultSet) this.resultset).getString("nchamada")+" - NOME: "+((ResultSet) this.resultset).getString("nome")+" - EMAIL: "+((ResultSet) this.resultset).getString("email"));
			}
		} catch (Exception e){
			System.out.println("Erro ao conectar no DATABASE: "+ e.getMessage());
		}
	}
	
	public void inserirAluno(Pessoa aluno, Informacoes inf){
		String comando = "INSERT INTO alunos(nome, idade, email) VALUES (?,?,?)";
		String comando2 = "INSERT INTO informacoes(sexo, barba, careca) VALUES (?,?,?)";
		try{
			PreparedStatement cmd = (PreparedStatement)this.conexao.prepareStatement(comando);
			PreparedStatement cmd2 = (PreparedStatement)this.conexao.prepareStatement(comando2);
			cmd.setString(1, aluno.getNome());
			cmd.setInt(2, aluno.getIdade());
			cmd.setString(3, aluno.getEmail());
			cmd2.setBoolean(1, inf.isSexo());
			cmd2.setBoolean(2, inf.isBarba());
			cmd2.setBoolean(3, inf.isCareca());
			cmd.executeUpdate();
			cmd2.executeUpdate();
			cmd.close();
			cmd2.close();
		} catch(Exception e) {
			System.out.println("Erro ao conectar no DATABASE: "+ e.getMessage());
		}
	}
	
	public void deletarAluno(Integer number){
		String comando = "DELETE FROM alunos WHERE nchamada = ?";
		String comando2 = "DELETE FROM informacoes WHERE id_carac = ?";
		try{
			PreparedStatement cmd = (PreparedStatement)this.conexao.prepareStatement(comando);
			PreparedStatement cmd2 = (PreparedStatement)this.conexao.prepareStatement(comando2);
			cmd.setInt(1, number);
			cmd.executeUpdate();
			cmd2.setInt(1,  number);
			cmd2.executeUpdate();
			cmd.close();
			cmd2.close();
		} catch(Exception e){
			System.out.println("Erro ao conectar ao DATABASE: "+e.getMessage());
		}
	}
	
	public void listarArray(){
		ReceberAlunos();
		tamanho = alunos.size();
		System.out.println("");
		for (Pessoa x : alunos){
			System.out.println("NOME: "+x.getNome()+"| CÃ“DIGO: "+x.getNchamada());
		}
		System.out.println("");
		for (Informacoes z : infs){
			System.out.println("SEXO: "+z.isSexo()+" | BARBA: "+z.isBarba()+" | COR DO CABELO: "+z.isCareca());
		}
	}
	
	public void alterarAluno(Integer code, Pessoa aluno, Informacoes inf){
		String comando = "UPDATE alunos SET nome = ?, email = ?, idade = ? WHERE nchamada = ?";
		String comando2 = "UPDATE informacoes SET sexo = ?, barba = ?, careca = ? WHERE id_carac = ?";
		try{
			PreparedStatement cmd = (PreparedStatement)this.conexao.prepareStatement(comando);
			PreparedStatement cmd2 = (PreparedStatement)this.conexao.prepareStatement(comando2);
			cmd.setString(1, aluno.getNome());
			cmd.setString(2, aluno.getEmail());
			cmd.setInt(3, aluno.getIdade());
			cmd.setInt(4, code);
			cmd2.setBoolean(1, inf.isSexo());
			cmd2.setBoolean(2, inf.isBarba());
			cmd2.setBoolean(3, inf.isCareca());
			cmd2.setInt(4, code);
			cmd.executeUpdate();
			cmd2.executeUpdate();
			cmd.close();
			cmd2.close();
		} catch (SQLException e){
			System.out.println("Erro ao CONETAR AO DB: "+e.getMessage());
		}
	}
}
